"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6032],{3446:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>s,contentTitle:()=>d,default:()=>g,frontMatter:()=>c,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"component/middleware/recovery","title":"Recovery","description":"Recovery middleware is used for abnormal recovery and prevents the program from exiting directly in the event of an exception to the service.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/component/middleware/07-recovery.md","sourceDirName":"component/middleware","slug":"/component/middleware/recovery","permalink":"/en/docs/component/middleware/recovery","draft":false,"unlisted":false,"editUrl":"https://github.com/go-kratos/go-kratos.dev/edit/main/i18n/en/docusaurus-plugin-content-docs/current/component/middleware/07-recovery.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"id":"recovery","title":"Recovery","keywords":["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},"sidebar":"docs","previous":{"title":"Rate Limiter","permalink":"/en/docs/component/middleware/ratelimit"},"next":{"title":"Tracing","permalink":"/en/docs/component/middleware/tracing"}}');var o=r(4848),i=r(8453);const c={id:"recovery",title:"Recovery",keywords:["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},d=void 0,s={},a=[{value:"configuration",id:"configuration",level:3},{value:"<code>WithHandler()</code>",id:"withhandler",level:4},{value:"<code>WithLogger()</code>",id:"withlogger",level:4},{value:"Usage",id:"usage",level:3},{value:"HTTP",id:"http",level:4},{value:"gRPC",id:"grpc",level:4}];function l(e){const n={code:"code",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Recovery middleware is used for abnormal recovery and prevents the program from exiting directly in the event of an exception to the service."}),"\n",(0,o.jsx)(n.h3,{id:"configuration",children:"configuration"}),"\n",(0,o.jsxs)(n.p,{children:["Two configuration methods are available in recovery middleware ",(0,o.jsx)(n.code,{children:"WithHandler()"})," and ",(0,o.jsx)(n.code,{children:"WithLogger()"}),"\u3002"]}),"\n",(0,o.jsx)(n.h4,{id:"withhandler",children:(0,o.jsx)(n.code,{children:"WithHandler()"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"func WithHandler(h HandlerFunc) Option {\n\treturn func(o *options) {\n\t\to.handler = h\n\t}\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["When you set up a service exception, you can use a custom ",(0,o.jsx)(n.code,{children:"handler"})," for handler processing, such as posting exception information to sentry."]}),"\n",(0,o.jsx)(n.h4,{id:"withlogger",children:(0,o.jsx)(n.code,{children:"WithLogger()"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"func WithLogger(logger log.Logger) Option {\n\treturn func(o *options) {\n\t\to.logger = logger\n\t}\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["To set up the ",(0,o.jsx)(n.code,{children:"logger"})," for logging."]}),"\n",(0,o.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,o.jsx)(n.h4,{id:"http",children:"HTTP"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"var opts = []http.ServerOption{\n\thttp.Middleware(\n\t\trecovery.Recovery(\n      recovery.WithLogger(log.DefaultLogger),\n\t\t\trecovery.WithHandler(func(ctx context.Context, req, err interface{}) error {\n\t\t\t\t\t// do someting\n\t\t\t\t\treturn nil\n\t\t\t}),\n    ),\n\t),\n}\nsrv := http.NewServer(opts...)\n"})}),"\n",(0,o.jsx)(n.h4,{id:"grpc",children:"gRPC"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-go",children:"var opts = []grpc.ServerOption{\n\tgrpc.Middleware(\n\t\trecovery.Recovery(\n\t\t\trecovery.WithLogger(log.DefaultLogger),\n\t\t\trecovery.WithHandler(func(ctx context.Context, req, err interface{}) error {\n\t\t\t\t// do someting\n\t\t\t\treturn nil\n\t\t\t}),\n\t\t),\n\t),\n}\nsrv := grpc.NewServer(opts...)\n"})})]})}function g(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>d});var t=r(6540);const o={},i=t.createContext(o);function c(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);