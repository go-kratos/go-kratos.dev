"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8253],{7743:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>a,contentTitle:()=>c,default:()=>l,frontMatter:()=>i,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"component/metrics","title":"Metrics","description":"Interface","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/component/07-metrics.md","sourceDirName":"component","slug":"/component/metrics","permalink":"/en/docs/component/metrics","draft":false,"unlisted":false,"editUrl":"https://github.com/go-kratos/go-kratos.dev/edit/main/i18n/en/docusaurus-plugin-content-docs/current/component/07-metrics.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"id":"metrics","title":"Metrics"},"sidebar":"docs","previous":{"title":"Metadata","permalink":"/en/docs/component/metadata"},"next":{"title":"Registry","permalink":"/en/docs/component/registry"}}');var s=n(4848),o=n(8453);const i={id:"metrics",title:"Metrics"},c=void 0,a={},u=[{value:"Interface",id:"interface",level:3},{value:"Counter",id:"counter",level:3},{value:"Gauge",id:"gauge",level:4},{value:"Observer",id:"observer",level:4},{value:"Usage",id:"usage",level:3},{value:"Metrics in server",id:"metrics-in-server",level:4},{value:"Metrics in Client",id:"metrics-in-client",level:4},{value:"References",id:"references",level:3}];function d(e){const t={a:"a",code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.h3,{id:"interface",children:"Interface"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"Counter"}),", ",(0,s.jsx)(t.code,{children:"Gauge"}),", ",(0,s.jsx)(t.code,{children:"Observer"})," are the three major metric interface of kratos."]}),"\n",(0,s.jsx)(t.h3,{id:"counter",children:"Counter"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-go",children:"\ntype Counter interface {\n\tWith(lvs ...string) Counter\n\tInc()\n\tAdd(delta float64)\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Counter is just a standard counter. It should expose ",(0,s.jsx)(t.code,{children:"Inc"})," and ",(0,s.jsx)(t.code,{children:"Add"})," method. This counter can only count the increasing. It usually used at counting the numbers of errors or QPS."]}),"\n",(0,s.jsx)(t.h4,{id:"gauge",children:"Gauge"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-go",children:"type Gauge interface {\n\tWith(lvs ...string) Gauge\n\tSet(value float64)\n\tAdd(delta float64)\n\tSub(delta float64)\n}\n"})}),"\n",(0,s.jsx)(t.p,{children:"Gauge is a status indicator. It records the current status of service. The value of gauge may increase or decrease. It usually used at monitoring CPU usage or Mem usage etc."}),"\n",(0,s.jsx)(t.h4,{id:"observer",children:"Observer"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-go",children:"type Observer interface {\n\tWith(lvs ...string) Observer\n\tObserve(float64)\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Observer is a kind of more complex metric. It provides more extra information for monitoring sums, quantities and percentages. It is corresponding to Prometheus'",(0,s.jsx)(t.strong,{children:"Histogram"})," and ",(0,s.jsx)(t.strong,{children:"Summary"}),". The Histogram is used for record the counts in different buckets, such as the count of requests in different latency ranges. The Histogram is efficient. Summary records the percentiles, because of extra computation, it maybe slower."]}),"\n",(0,s.jsx)(t.h3,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(t.h4,{id:"metrics-in-server",children:"Metrics in server"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-go",children:'import (\n\t"github.com/go-kratos/kratos/v2/middleware"\n\tkmetrics "github.com/go-kratos/prometheus/metrics"\n\t"github.com/go-kratos/kratos/v2/middleware/metrics"\n\t"github.com/go-kratos/kratos/v2/transport/http"\n\t"github.com/prometheus/client_golang/prometheus"\n)\nfunc NewHTTPServer(c *conf.Server) *http.Server {\n    // for prometheus \n\tcounter := prometheus.NewCounterVec(prometheus.CounterOpts{Name: "kratos_counter"}, []string{"server", "qps"})\n\tvar opts = []http.ServerOption{\n\t\thttp.Middleware(\n\t\t\tmiddleware.Chain(\n\t\t\t\trecovery.Recovery(),\n\t\t\t\tmetrics.Server(metrics.WithRequests(kmetrics.NewCounter(counter))),\n\t\t\t),\n\t\t),\n\t}\n\n'})}),"\n",(0,s.jsx)(t.h4,{id:"metrics-in-client",children:"Metrics in Client"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-go",children:'import (\n\t"context"\n\n\t"github.com/go-kratos/kratos/v2/middleware"\n\tkmetrics "github.com/go-kratos/prometheus/metrics"\n\n\t"github.com/go-kratos/kratos/v2/middleware/metrics"\n\t"github.com/go-kratos/kratos/v2/transport/http"\n\t"github.com/prometheus/client_golang/prometheus"\n)\nfunc useClient() {\n\tcounter := prometheus.NewCounterVec(prometheus.CounterOpts{Name: "kratos_counter"},\n\t\t[]string{"client", "qps"})\n\tclient, _ := http.NewClient(context.Background(),\n\t\thttp.WithMiddleware(metrics.Client(metrics.WithRequests(kmetrics.NewCounter(counter)))))\n\t// ...\n}\n'})}),"\n",(0,s.jsx)(t.h3,{id:"references",children:"References"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"https://prometheus.io/docs/concepts/metric_types/",children:"https://prometheus.io/docs/concepts/metric_types/"})}),"\n"]})]})}function l(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>i,x:()=>c});var r=n(6540);const s={},o=r.createContext(s);function i(e){const t=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);