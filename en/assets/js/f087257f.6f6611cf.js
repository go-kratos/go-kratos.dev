"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[214],{4798:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>s,contentTitle:()=>a,default:()=>u,frontMatter:()=>c,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"component/middleware/circuitbreaker","title":"Circuit Breaker","description":"Circuit breaker middleware for providing client-side breaker functionality, with sre breaker algorithm implemented by default\u3002","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/component/middleware/03-circuitbreaker.md","sourceDirName":"component/middleware","slug":"/component/middleware/circuitbreaker","permalink":"/en/docs/component/middleware/circuitbreaker","draft":false,"unlisted":false,"editUrl":"https://github.com/go-kratos/go-kratos.dev/edit/main/i18n/en/docusaurus-plugin-content-docs/current/component/middleware/03-circuitbreaker.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"circuitbreaker","title":"Circuit Breaker","keywords":["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},"sidebar":"docs","previous":{"title":"Authentication","permalink":"/en/docs/component/middleware/auth"},"next":{"title":"Logging","permalink":"/en/docs/component/middleware/logging"}}');var t=i(4848),o=i(8453);const c={id:"circuitbreaker",title:"Circuit Breaker",keywords:["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},a=void 0,s={},d=[{value:"Configuration",id:"configuration",level:3},{value:"<code>WithGroup</code>",id:"withgroup",level:4},{value:"Usage",id:"usage",level:3},{value:"Use circuit breaker in client",id:"use-circuit-breaker-in-client",level:4},{value:"Trigger circuit breaker",id:"trigger-circuit-breaker",level:4}];function l(e){const r={a:"a",code:"code",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.p,{children:["Circuit breaker middleware for providing client-side breaker functionality, with ",(0,t.jsx)(r.a,{href:"https://github.com/go-kratos/aegis/tree/main/circuitbreaker/sre",children:"sre breaker"})," algorithm implemented by default\u3002"]}),"\n",(0,t.jsx)(r.h3,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(r.h4,{id:"withgroup",children:(0,t.jsx)(r.code,{children:"WithGroup"})}),"\n",(0,t.jsxs)(r.p,{children:["breaker depends on ",(0,t.jsx)(r.code,{children:"container/group"})," to implement the use of mutually independent breaker for different ",(0,t.jsx)(r.code,{children:"Operation"}),".\nuse ",(0,t.jsx)(r.code,{children:"WithGroup"})," to configure a costom Breaker to replace the default breaker algorithm\uff1a"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-go",children:"// WithGroup with circuit breaker group.\n// NOTE: implements generics circuitbreaker.CircuitBreaker\nfunc WithGroup(g *group.Group) Option {\n\treturn func(o *options) {\n\t\to.group = g\n\t}\n}\n"})}),"\n",(0,t.jsxs)(r.p,{children:["The default configuration generates separate breakers for different ",(0,t.jsx)(r.code,{children:"Operation"}),"(s)."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-go",children:"opt := &options{\n\tgroup: group.NewGroup(func() interface{} {\n\t\treturn sre.NewBreaker()\n\t}),\n}\n"})}),"\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"group.Group"})," is a ",(0,t.jsx)(r.code,{children:"lazy load container"})," . The instance of ",(0,t.jsx)(r.strong,{children:"group.Group"})," should be implement the ",(0,t.jsx)(r.strong,{children:"CircuitBreaker"})," interface in ",(0,t.jsx)(r.code,{children:"aegis/circuitbreaker"})]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-go",children:"// CircuitBreaker is a circuit breaker.\ntype CircuitBreaker interface {\n\tAllow() error // it means rejected when return error\n  MarkSuccess() \n\tMarkFailed() \n}\n"})}),"\n",(0,t.jsx)(r.h3,{id:""}),"\n",(0,t.jsx)(r.h3,{id:"usage",children:"Usage"}),"\n",(0,t.jsx)(r.h4,{id:"use-circuit-breaker-in-client",children:"Use circuit breaker in client"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-go",children:'// http\nconn, err := http.NewClient(\n\tcontext.Background(),\n\thttp.WithMiddleware(\n\t\tcircuitbreaker.Client(),\n\t),\n\thttp.WithEndpoint("127.0.0.1:8000"),\n)\n// grpc \nconn,err := transgrpc.Dial(\n  context.Background(), \n\tgrpc.WithMiddleware(\n\t\tcircuitbreaker.Client(),\n\t),\n  grpc.WithEndpoint("127.0.0.1:9000"),\n)\n'})}),"\n",(0,t.jsx)(r.h4,{id:"trigger-circuit-breaker",children:"Trigger circuit breaker"}),"\n",(0,t.jsxs)(r.p,{children:["When the breaker is triggered, the client call for this ",(0,t.jsx)(r.code,{children:"Operation"})," fails quickly for a period of time and returns the error ",(0,t.jsx)(r.code,{children:"ErrNotAllowed"})," immediately\uff0cwhich defined as follows\uff1a"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-go",children:'// ErrNotAllowed is request failed due to circuit breaker triggered.\nvar ErrNotAllowed = errors.New(503, "CIRCUITBREAKER", "request failed due to circuit breaker triggered")\n'})})]})}function u(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,r,i)=>{i.d(r,{R:()=>c,x:()=>a});var n=i(6540);const t={},o=n.createContext(t);function c(e){const r=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function a(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),n.createElement(o.Provider,{value:r},e.children)}}}]);