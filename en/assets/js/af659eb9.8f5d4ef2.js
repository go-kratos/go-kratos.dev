"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8852],{3627:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>g,frontMatter:()=>s,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"guide/wire","title":"Dependency Injection","description":"Wire is a compile-time dependency injection tool.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/guide/03-wire.md","sourceDirName":"guide","slug":"/guide/wire","permalink":"/en/docs/guide/wire","draft":false,"unlisted":false,"editUrl":"https://github.com/go-kratos/go-kratos.dev/edit/main/i18n/en/docusaurus-plugin-content-docs/current/guide/03-wire.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"wire","title":"Dependency Injection"},"sidebar":"docs","previous":{"title":"OpenAPI Swagger","permalink":"/en/docs/guide/openapi"},"next":{"title":"Ent","permalink":"/en/docs/guide/ent"}}');var t=r(4848),o=r(8453);const s={id:"wire",title:"Dependency Injection"},a=void 0,c={},d=[{value:"Installation",id:"installation",level:3},{value:"Terms",id:"terms",level:3},{value:"Usage",id:"usage",level:3},{value:"Component Initialization",id:"component-initialization",level:3},{value:"References",id:"references",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Wire"})," is a compile-time dependency injection tool."]}),"\n",(0,t.jsx)(n.p,{children:"It is recommended that doing explicit initialization rather than using global variables."}),"\n",(0,t.jsxs)(n.p,{children:["Generating the initialization codes by ",(0,t.jsx)(n.em,{children:"Wire"})," can reduce the coupling among components and increase the maintainability of the project."]}),"\n",(0,t.jsx)(n.h3,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Import into project\ngo get -u github.com/google/wire\n\n# Install cmd\ngo install github.com/google/wire/cmd/wire\n"})}),"\n",(0,t.jsx)(n.h3,{id:"terms",children:"Terms"}),"\n",(0,t.jsxs)(n.p,{children:["There are two basic terms in wire, ",(0,t.jsx)(n.em,{children:"Provider"})," and ",(0,t.jsx)(n.em,{children:"Injector"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Provider is a ",(0,t.jsx)(n.em,{children:"Go Func"}),", it can also receive the values from other ",(0,t.jsx)(n.em,{children:"Provider"}),"s for dependency injection."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"// provides a config file\nfunc NewConfig() *conf.Data {...}\n\n// provides the data component (the initialization of database, cache and etc.) which depends on the data config.\nfunc NewData(c *conf.Data) (*Data, error) {...}\n\n// provides persistence components (implementation of CRUD persistence) which depends on the data component.\nfunc NewUserRepo(d *data.Data) (*UserRepo, error) {...}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,t.jsxs)(n.p,{children:["In Kratos project, there are four major modules, ",(0,t.jsx)(n.em,{children:"server, service, biz and data"}),". They will be initialized by ",(0,t.jsx)(n.em,{children:"Wire"}),"."]}),"\n",(0,t.jsx)("img",{src:"/images/wire.png",alt:"kratos ddd",width:"650px"}),"\n",(0,t.jsxs)(n.p,{children:["A ",(0,t.jsx)(n.em,{children:"ProviderSet"})," should be provided in every module so that wire could scan them and generate the DI codes."]}),"\n",(0,t.jsx)(n.p,{children:"First, you should define ProviderSet in the entry of every module.\nThe"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"-data\n--data.go    // var ProviderSet = wire.NewSet(NewData, NewGreeterRepo)\n--greeter.go // func NewGreeterRepo(data *Data, logger log.Logger) biz.GreeterRepo {...}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Then put these ",(0,t.jsx)(n.em,{children:"ProviderSet"})," in the ",(0,t.jsx)(n.em,{children:"wire.go"})," for DI configuration."]}),"\n",(0,t.jsx)(n.h3,{id:"component-initialization",children:"Component Initialization"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"wire.go"})," is required for DI. The kratos application is for lifecycle management."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"// the entry point of the application\ncmd\n-main.go\n-wire.go\n-wire_gen.go\n\n// main.go creates the kratos application for lifecycle management.\nfunc newApp(logger log.Logger, hs *http.Server, gs *grpc.Server, greeter *service.GreeterService) *kratos.App {\n    pb.RegisterGreeterServer(gs, greeter)\n    pb.RegisterGreeterHTTPServer(hs, greeter)\n    return kratos.New(\n        kratos.Name(Name),\n        kratos.Version(Version),\n        kratos.Logger(logger),\n        kratos.Server(\n            hs,\n            gs,\n        ),\n    )\n}\n\n// wire.go initialization\nfunc initApp(*conf.Server, *conf.Data, log.Logger) (*kratos.App, error) {\n    //  builds ProviderSet in every modules, for the generation of wire_gen.go\n    panic(wire.Build(server.ProviderSet, data.ProviderSet, biz.ProviderSet, service.ProviderSet, newApp))\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["run ",(0,t.jsx)(n.code,{children:"go generate"})," command in main directory to generate DI codes."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"go generate ./...\n"})}),"\n",(0,t.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://blog.golang.org/wire",children:"https://blog.golang.org/wire"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://github.com/google/wire",children:"https://github.com/google/wire"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://medium.com/@dche423/master-wire-cn-d57de86caa1b",children:"https://medium.com/@dche423/master-wire-cn-d57de86caa1b"})}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>s,x:()=>a});var i=r(6540);const t={},o=i.createContext(t);function s(e){const n=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);