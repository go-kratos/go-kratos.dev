"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5321],{8338:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>n,toc:()=>a});const n=JSON.parse('{"id":"intro/faq","title":"FAQ","description":"Kratos FAQ","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/intro/03-faq.md","sourceDirName":"intro","slug":"/intro/faq","permalink":"/en/docs/intro/faq","draft":false,"unlisted":false,"editUrl":"https://github.com/go-kratos/go-kratos.dev/edit/main/i18n/en/docusaurus-plugin-content-docs/current/intro/03-faq.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"faq","title":"FAQ","description":"Kratos FAQ","keywords":["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},"sidebar":"docs","previous":{"title":"Design","permalink":"/en/docs/intro/design"},"next":{"title":"Layout","permalink":"/en/docs/intro/layout"}}');var r=t(4848),i=t(8453);const s={id:"faq",title:"FAQ",description:"Kratos FAQ",keywords:["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},l=void 0,d={},a=[{value:"1. <code>google/protobuf/descriptor.proto: File not found.</code> error while using <code>kratos proto</code> command.",id:"1-googleprotobufdescriptorproto-file-not-found-error-while-using-kratos-proto-command",level:3},{value:"2. There are errors from IDE show <code>import &quot;google/api/annotations.proto&quot;;</code> with red wavy line",id:"2-there-are-errors-from-ide-show-import-googleapiannotationsproto-with-red-wavy-line",level:3},{value:"3. Develop with goland",id:"3-develop-with-goland",level:3},{value:"4. The code newly generated after the new release is unavailable, with system alarming errors.",id:"4-the-code-newly-generated-after-the-new-release-is-unavailable-with-system-alarming-errors",level:3},{value:"5. After invoke <code>kratos client</code>, there are no deserved http file.",id:"5-after-invoke-kratos-client-there-are-no-deserved-http-file",level:3},{value:"6. It show <code>Command not found: kratos</code> after installed Kratos",id:"6-it-show-command-not-found-kratos-after-installed-kratos",level:3},{value:"7. It show some proto file not found when generate pb file.",id:"7-it-show-some-proto-file-not-found-when-generate-pb-file",level:3},{value:"8.There are  <code>// no validation rules for xxxx</code> for configurated property.",id:"8there-are---no-validation-rules-for-xxxx-for-configurated-property",level:3},{value:"9. Custom Http return value",id:"9-custom-http-return-value",level:3},{value:"10. How to control the http return field 0 value ignore field and use proto&#39;s message field as the http return field",id:"10-how-to-control-the-http-return-field-0-value-ignore-field-and-use-protos-message-field-as-the-http-return-field",level:3},{value:"11\u3001Controls the name and number of the enum (enumeration type) returned by http",id:"11controls-the-name-and-number-of-the-enum-enumeration-type-returned-by-http",level:3}];function c(e){const o={a:"a",code:"code",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(o.h3,{id:"1-googleprotobufdescriptorproto-file-not-found-error-while-using-kratos-proto-command",children:["1. ",(0,r.jsx)(o.code,{children:"google/protobuf/descriptor.proto: File not found."})," error while using ",(0,r.jsx)(o.code,{children:"kratos proto"})," command."]}),"\n",(0,r.jsxs)(o.p,{children:["This issue is mainly caused by the improperly installation of protoc. The documentation ",(0,r.jsx)(o.a,{href:"https://grpc.io/docs/protoc-installation/",children:"protoc-installation"})," shows the correct way to install protoc. It is highly recommended that install protoc by system package manager to ensure the installation's integrity. If you have to install the pre-compiled version, please refer to the ",(0,r.jsx)(o.code,{children:"readme.txt"})," in the zip file, make sure all the files under ",(0,r.jsx)(o.code,{children:"include"})," folder could be put to correct include path of your system, e.g. ",(0,r.jsx)(o.code,{children:"/usr/local/include/"}),", so that protoc can find them while compiling."]}),"\n",(0,r.jsxs)(o.h3,{id:"2-there-are-errors-from-ide-show-import-googleapiannotationsproto-with-red-wavy-line",children:["2. There are errors from IDE show ",(0,r.jsx)(o.code,{children:'import "google/api/annotations.proto";'})," with red wavy line"]}),"\n",(0,r.jsxs)(o.p,{children:["You can append ",(0,r.jsx)(o.code,{children:"thrid_party"})," directory to custom protobuf`s include paths. Please follow these doc:"]}),"\n",(0,r.jsxs)(o.ul,{children:["\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.a,{href:"https://github.com/ksprojects/protobuf-jetbrains-plugin#configuration",children:"GoLand"})}),"\n",(0,r.jsx)(o.li,{children:(0,r.jsx)(o.a,{href:"https://github.com/zxh0/vscode-proto3#extension-settings",children:"VSCode"})}),"\n"]}),"\n",(0,r.jsx)(o.h3,{id:"3-develop-with-goland",children:"3. Develop with goland"}),"\n",(0,r.jsx)(o.p,{children:"All you need to do is configurate some setting like this:"}),"\n",(0,r.jsx)("img",{src:"/images/goland.png",width:"650px"}),"\n",(0,r.jsx)(o.h3,{id:"4-the-code-newly-generated-after-the-new-release-is-unavailable-with-system-alarming-errors",children:"4. The code newly generated after the new release is unavailable, with system alarming errors."}),"\n",(0,r.jsx)(o.p,{children:"You can try to follow this:"}),"\n",(0,r.jsxs)(o.ol,{children:["\n",(0,r.jsx)(o.li,{children:"kratos upgrade"}),"\n",(0,r.jsxs)(o.li,{children:["Modify the version of kratos in ",(0,r.jsx)(o.code,{children:"go.mod"})," file"]}),"\n",(0,r.jsx)(o.li,{children:"go generate ./..."}),"\n"]}),"\n",(0,r.jsxs)(o.h3,{id:"5-after-invoke-kratos-client-there-are-no-deserved-http-file",children:["5. After invoke ",(0,r.jsx)(o.code,{children:"kratos client"}),", there are no deserved http file."]}),"\n",(0,r.jsxs)(o.p,{children:["You can run ",(0,r.jsx)(o.code,{children:"make http"})," or ",(0,r.jsx)(o.code,{children:"kratos client xxx --go-http_opt=omitempty=false"})]}),"\n",(0,r.jsxs)(o.h3,{id:"6-it-show-command-not-found-kratos-after-installed-kratos",children:["6. It show ",(0,r.jsx)(o.code,{children:"Command not found: kratos"})," after installed Kratos"]}),"\n",(0,r.jsxs)(o.p,{children:["Make sure the env value ",(0,r.jsx)(o.code,{children:"PATH"})," contain ",(0,r.jsx)(o.code,{children:"GOBIN"})," directory. Or you can invoke ",(0,r.jsx)(o.code,{children:"kratos"})," inside ",(0,r.jsx)(o.code,{children:"GOBIN"})," directory."]}),"\n",(0,r.jsx)(o.h3,{id:"7-it-show-some-proto-file-not-found-when-generate-pb-file",children:"7. It show some proto file not found when generate pb file."}),"\n",(0,r.jsxs)(o.p,{children:["Copy the missing proto file to ",(0,r.jsx)(o.code,{children:"third_party"})," directory. Or append missing proto file location to corresponding Makefile command."]}),"\n",(0,r.jsxs)(o.h3,{id:"8there-are---no-validation-rules-for-xxxx-for-configurated-property",children:["8.There are  ",(0,r.jsx)(o.code,{children:"// no validation rules for xxxx"})," for configurated property."]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{children:"git clone github.com/envoyproxy/protoc-gen-validate\ncd protoc-gen-validate\nmake build\n"})}),"\n",(0,r.jsx)(o.h3,{id:"9-custom-http-return-value",children:"9. Custom Http return value"}),"\n",(0,r.jsxs)(o.p,{children:["You can write a custom ",(0,r.jsx)(o.code,{children:"ResponseEncoder"})," and set to ",(0,r.jsx)(o.code,{children:"http.Server()"})," by using ",(0,r.jsx)(o.code,{children:"http.ResponseEncoder()"})]}),"\n",(0,r.jsx)(o.h3,{id:"10-how-to-control-the-http-return-field-0-value-ignore-field-and-use-protos-message-field-as-the-http-return-field",children:"10. How to control the http return field 0 value ignore field and use proto's message field as the http return field"}),"\n",(0,r.jsxs)(o.p,{children:["You can import it in the ",(0,r.jsx)(o.code,{children:"main.go"})," of the http service"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{children:'import (\n  "github.com/go-kratos/kratos/v2/encoding/json"\n  "google.golang.org/protobuf/encoding/protojson"\n)\n'})}),"\n",(0,r.jsxs)(o.p,{children:["Set ",(0,r.jsx)(o.code,{children:"json.MarshalOptions"})," in the init method"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{children:'func init() {\n    flag.StringVar(&flagconf, "conf", "../../configs", "config path, eg: -conf config.yaml")\n    //Add this code\n    json.MarshalOptions = protojson.MarshalOptions{\n        EmitUnpopulated: true, //Default value not ignored\n        UseProtoNames:   true, //Use proto name to return http field\n    }\n}\n'})}),"\n",(0,r.jsx)(o.h3,{id:"11controls-the-name-and-number-of-the-enum-enumeration-type-returned-by-http",children:"11\u3001Controls the name and number of the enum (enumeration type) returned by http"}),"\n",(0,r.jsxs)(o.p,{children:["You can import it in the ",(0,r.jsx)(o.code,{children:"main.go"})," of the http service"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{children:'import (\n  "github.com/go-kratos/kratos/v2/encoding/json"\n  "google.golang.org/protobuf/encoding/protojson"\n)\n'})}),"\n",(0,r.jsxs)(o.p,{children:["Set ",(0,r.jsx)(o.code,{children:"json.MarshalOptions"})," in the init method"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{children:'func init() {\n    flag.StringVar(&flagconf, "conf", "../../configs", "config path, eg: -conf config.yaml")\n    // Add this code\n    json.MarshalOptions = protojson.MarshalOptions{\n        UseEnumNumbers: true, // UseEnumNumbers emits enum values as numbers.\n    }\n}\n'})}),"\n",(0,r.jsxs)(o.p,{children:["For more control over http return content, please refer to the documentation: ",(0,r.jsx)(o.a,{href:"https://pkg.go.dev/google.golang.org/protobuf@v1.30.0/encoding/protojson#MarshalOptions",children:"https://pkg.go.dev/google.golang.org/protobuf@v1.30.0/encoding/protojson#MarshalOptions"})]})]})}function h(e={}){const{wrapper:o}={...(0,i.R)(),...e.components};return o?(0,r.jsx)(o,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,o,t)=>{t.d(o,{R:()=>s,x:()=>l});var n=t(6540);const r={},i=n.createContext(r);function s(e){const o=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function l(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),n.createElement(i.Provider,{value:o},e.children)}}}]);