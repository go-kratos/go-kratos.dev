"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[7527],{5437:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"guide/ent","title":"Ent","description":"Any ORM or library is supported in Kratos project for data accessing. Please refer to the examples for integration.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/guide/04-ent.md","sourceDirName":"guide","slug":"/guide/ent","permalink":"/en/docs/guide/ent","draft":false,"unlisted":false,"editUrl":"https://github.com/go-kratos/go-kratos.dev/edit/main/i18n/en/docusaurus-plugin-content-docs/current/guide/04-ent.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"id":"ent","title":"Ent"},"sidebar":"docs","previous":{"title":"Dependency Injection","permalink":"/en/docs/guide/wire"},"next":{"title":"\u8fd0\u7ef4\u6307\u5357","permalink":"/en/docs/category/\u8fd0\u7ef4\u6307\u5357"}}');var s=t(4848),i=t(8453);const c={id:"ent",title:"Ent"},o=void 0,a={},l=[{value:"Install Ent",id:"install-ent",level:3},{value:"Create Schema",id:"create-schema",level:3},{value:"Create DB Connection Client",id:"create-db-connection-client",level:3},{value:"References",id:"references",level:3}];function d(e){const n={a:"a",code:"code",em:"em",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["Any ORM or library is supported in Kratos project for data accessing. Please refer to the ",(0,s.jsx)(n.a,{href:"https://github.com/go-kratos/examples/tree/main",children:"examples"})," for integration."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Ent"})," is an easy-to-use ORM which developed by ",(0,s.jsx)(n.em,{children:"Facebook"}),". Here is a brief guide to use this library."]}),"\n",(0,s.jsx)(n.h3,{id:"install-ent",children:"Install Ent"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"go install entgo.io/ent/cmd/ent@latest\n"})}),"\n",(0,s.jsx)(n.h3,{id:"create-schema",children:"Create Schema"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"ent new User\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This command will generate schema in ",(0,s.jsx)(n.code,{children:"project/ent/schema/"})," directory."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'// <project>/ent/schema/user.go\n\npackage schema\n\nimport "entgo.io/ent"\n\n// User holds the schema definition for the User entity.\ntype User struct {\n    ent.Schema\n}\n\n// Fields of the User.\nfunc (User) Fields() []ent.Field {\n    return nil\n}\n\n// Edges of the User.\nfunc (User) Edges() []ent.Edge {\n    return nil\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Add two fields ",(0,s.jsx)(n.code,{children:"name\u3001age"})," to ",(0,s.jsx)(n.code,{children:"User"})," table."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package schema\n\nimport (\n    "entgo.io/ent"\n    "entgo.io/ent/schema/field"\n)\n\n// Fields of the User.\nfunc (User) Fields() []ent.Field {\n    return []ent.Field{\n        field.Int("age").\n            Positive(),\n        field.String("name").\n            Default("unknown"),\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Run ",(0,s.jsx)(n.code,{children:"go generate"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"go generate ./ent\n# ent generate ./ent/schema\n"})}),"\n",(0,s.jsx)(n.h3,{id:"create-db-connection-client",children:"Create DB Connection Client"}),"\n",(0,s.jsxs)(n.p,{children:["First, create a new ",(0,s.jsx)(n.code,{children:"ent.Client"}),". We use SQLite3 here for demonstration."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'package main\n\nimport (\n    "context"\n    "log"\n\n    "<project>/ent"\n\n    _ "github.com/mattn/go-sqlite3"\n)\n\nfunc main() {\n    client, err := ent.Open("sqlite3", "file:ent?mode=memory&cache=shared&_fk=1")\n    if err != nil {\n        log.Fatalf("failed opening connection to sqlite: %v", err)\n    }\n    defer client.Close()\n    // Run the auto migration tool.\n    if err := client.Schema.Create(context.Background()); err != nil {\n        log.Fatalf("failed creating schema resources: %v", err)\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["To create a ",(0,s.jsx)(n.code,{children:"User"})," in table."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-go",children:'func CreateUser(ctx context.Context, client *ent.Client) (*ent.User, error) {\n    u, err := client.User.\n        Create().\n        SetAge(30).\n        SetName("a8m").\n        Save(ctx)\n    if err != nil {\n        return nil, fmt.Errorf("failed creating user: %v", err)\n    }\n    log.Println("user was created: ", u)\n    return u, nil\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://entgo.io/docs/getting-started/",children:"https://entgo.io/docs/getting-started/"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://github.com/go-kratos/examples/tree/main/blog/internal/data",children:"https://github.com/go-kratos/examples/tree/main/blog/internal/data"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>o});var r=t(6540);const s={},i=r.createContext(s);function c(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);