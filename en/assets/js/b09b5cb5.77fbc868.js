"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5231],{3919:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>s,contentTitle:()=>a,default:()=>m,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"component/middleware/ratelimit","title":"Rate Limiter","description":"Rate limiter middleware for server-side traffic control, with bbr limiter algorithm implemented by default.","source":"@site/i18n/en/docusaurus-plugin-content-docs/current/component/middleware/06-ratelimit.md","sourceDirName":"component/middleware","slug":"/component/middleware/ratelimit","permalink":"/en/docs/component/middleware/ratelimit","draft":false,"unlisted":false,"editUrl":"https://github.com/go-kratos/go-kratos.dev/edit/main/i18n/en/docusaurus-plugin-content-docs/current/component/middleware/06-ratelimit.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"ratelimit","title":"Rate Limiter","keywords":["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},"sidebar":"docs","previous":{"title":"Metrics","permalink":"/en/docs/component/middleware/metrics"},"next":{"title":"Recovery","permalink":"/en/docs/component/middleware/recovery"}}');var n=t(4848),o=t(8453);const l={id:"ratelimit",title:"Rate Limiter",keywords:["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},a=void 0,s={},c=[{value:"Configuration",id:"configuration",level:3},{value:"<code>WithLimiter</code>",id:"withlimiter",level:4},{value:"Usage",id:"usage",level:3},{value:"Use rate limiter in Server",id:"use-rate-limiter-in-server",level:4},{value:"Trigger rate limiter",id:"trigger-rate-limiter",level:4}];function d(e){const i={a:"a",code:"code",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(i.p,{children:["Rate limiter middleware for server-side traffic control, with ",(0,n.jsx)(i.a,{href:"https://github.com/go-kratos/aegis/tree/main/ratelimit/bbr",children:"bbr limiter"})," algorithm implemented by default."]}),"\n",(0,n.jsx)(i.h3,{id:"configuration",children:"Configuration"}),"\n",(0,n.jsx)(i.h4,{id:"withlimiter",children:(0,n.jsx)(i.code,{children:"WithLimiter"})}),"\n",(0,n.jsx)(i.p,{children:"Used to replace the default limiter algorithm"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-go",children:"// WithLimiter set Limiter implementation,\n// default is bbr limiter\nfunc WithLimiter(limiter ratelimit.Limiter) Option {\n    return func(o *options) {\n        o.limiter = limiter\n    }\n}\n"})}),"\n",(0,n.jsxs)(i.p,{children:["The custom limiter needs to implement the ",(0,n.jsx)(i.code,{children:"Limiter"})," interface of ",(0,n.jsx)(i.a,{href:"https://github.com/go-kratos/aegis/blob/main/ratelimit/ratelimit.go",children:"aegis/ratelimit"}),"."]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-go",children:"// Limiter is a rate limiter.\ntype Limiter interface {\n    Allow() (DoneFunc, error)\n}\n"})}),"\n",(0,n.jsx)(i.h3,{id:"usage",children:"Usage"}),"\n",(0,n.jsx)(i.h4,{id:"use-rate-limiter-in-server",children:"Use rate limiter in Server"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-go",children:"var opts = []http.ServerOption{\n    http.Middleware(\n        // default is bbr limiter\n        ratelimit.Server(),\n        // custom limiter\n        //ratelimit.Server(ratelimit.WithLimiter(limiter)),\n    ),\n}\n\nsrv := http.NewServer(opts...)\n"})}),"\n",(0,n.jsx)(i.h4,{id:"trigger-rate-limiter",children:"Trigger rate limiter"}),"\n",(0,n.jsxs)(i.p,{children:["When the rate limiter is triggered, the current request is rejected directly and error ",(0,n.jsx)(i.code,{children:"ErrLimitExceed"})," will be returned, as defined below:"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-go",children:'// ErrLimitExceed is service unavailable due to rate limit exceeded.\nvar ErrLimitExceed = errors.New(429, "RATELIMIT", "service unavailable due to rate limit exceeded")\n'})})]})}function m(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,i,t)=>{t.d(i,{R:()=>l,x:()=>a});var r=t(6540);const n={},o=r.createContext(n);function l(e){const i=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),r.createElement(o.Provider,{value:i},e.children)}}}]);