"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1164],{433:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>c,default:()=>m,frontMatter:()=>d,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"component/metadata","title":"\u5143\u4fe1\u606f\u4f20\u9012","description":"\u5fae\u670d\u52a1\u4e4b\u95f4\u901a\u8fc7 HTTP \u548c gRPC API \u8fdb\u884c\u63a5\u53e3\u4ea4\u4e92\uff0c\u670d\u52a1\u67b6\u6784\u9700\u8981\u4f7f\u7528\u7edf\u4e00\u7684\u5143\u4fe1\u606f\uff08Metadata\uff09\u4f20\u8f93\u8fdb\u884c\u5fae\u670d\u52a1\u95f4\u7684\u4f20\u9012\u3002","source":"@site/docs/component/06-metadata.md","sourceDirName":"component","slug":"/component/metadata","permalink":"/docs/component/metadata","draft":false,"unlisted":false,"editUrl":"https://github.com/go-kratos/go-kratos.dev/edit/main/docs/component/06-metadata.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"metadata","title":"\u5143\u4fe1\u606f\u4f20\u9012","keywords":["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},"sidebar":"docs","previous":{"title":"\u65e5\u5fd7","permalink":"/docs/component/log"},"next":{"title":"\u76d1\u63a7\u63a5\u53e3","permalink":"/docs/component/metrics"}}');var a=n(4848),o=n(8453);const d={id:"metadata",title:"\u5143\u4fe1\u606f\u4f20\u9012",keywords:["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},c=void 0,i={},l=[{value:"\u9ed8\u8ba4\u683c\u5f0f\u89c4\u8303",id:"\u9ed8\u8ba4\u683c\u5f0f\u89c4\u8303",level:3},{value:"\u4f7f\u7528\u65b9\u5f0f",id:"\u4f7f\u7528\u65b9\u5f0f",level:3},{value:"\u6ce8\u518c\u5143\u4fe1\u606f\u4e2d\u95f4\u4ef6",id:"\u6ce8\u518c\u5143\u4fe1\u606f\u4e2d\u95f4\u4ef6",level:4},{value:"\u83b7\u53d6\u5143\u4fe1\u606f\u5b57\u6bb5\u7684\u503c",id:"\u83b7\u53d6\u5143\u4fe1\u606f\u5b57\u6bb5\u7684\u503c",level:4},{value:"\u8bbe\u7f6e\u5143\u4fe1\u606f\u5b57\u6bb5\u7684\u503c",id:"\u8bbe\u7f6e\u5143\u4fe1\u606f\u5b57\u6bb5\u7684\u503c",level:4}];function s(e){const t={code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"\u5fae\u670d\u52a1\u4e4b\u95f4\u901a\u8fc7 HTTP \u548c gRPC API \u8fdb\u884c\u63a5\u53e3\u4ea4\u4e92\uff0c\u670d\u52a1\u67b6\u6784\u9700\u8981\u4f7f\u7528\u7edf\u4e00\u7684\u5143\u4fe1\u606f\uff08Metadata\uff09\u4f20\u8f93\u8fdb\u884c\u5fae\u670d\u52a1\u95f4\u7684\u4f20\u9012\u3002\n\u76ee\u524d gRPC \u4e2d\u53ef\u4ee5\u643a\u5e26\u5143\u4fe1\u606f\u4f20\u9012\uff0c\u539f\u7406\u662f\u5c06\u5143\u4fe1\u606f\u653e\u5165 HTTP Header \u4e2d\uff0c\u8fd9\u6837\u4e0a\u6e38\u5373\u53ef\u6536\u5230\u5bf9\u5e94\u7684\u5143\u4fe1\u606f \u4fe1\u606f\u3002\n\u56e0\u6b64\u5728Kratos\u7684\u8bbe\u8ba1\u4e0a\uff0c\u4e5f\u662f\u901a\u8fc7 HTTP Header \u8fdb\u884c\u4f20\u9012\u3002\u5728\u6846\u67b6\u4e2d\u5148\u5c06\u5143\u4fe1\u606f\u5305\u5c01\u88c5\u6210key/value\u7ed3\u6784\uff0c\u7136\u540e\u643a\u5e26\u5230 Transport Header \u4e2d\u3002"}),"\n",(0,a.jsx)(t.h3,{id:"\u9ed8\u8ba4\u683c\u5f0f\u89c4\u8303",children:"\u9ed8\u8ba4\u683c\u5f0f\u89c4\u8303"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"x-md-global-xxx\uff0c\u5168\u5c40\u4f20\u9012\uff0c\u4f8b\u5982 mirror/color/criticality"}),"\n",(0,a.jsx)(t.li,{children:"x-md-local-xxx\uff0c\u5c40\u90e8\u4f20\u9012\uff0c\u4f8b\u5982 caller"}),"\n"]}),"\n",(0,a.jsx)(t.p,{children:"\u4e5f\u53ef\u4ee5\u5728 middleware/metadata \u5b9a\u5236\u81ea\u5df1\u7684 key prefix\uff0c\u914d\u7f6e\u56fa\u5b9a\u7684\u5143\u4fe1\u606f\u4f20\u9012"}),"\n",(0,a.jsx)(t.h3,{id:"\u4f7f\u7528\u65b9\u5f0f",children:"\u4f7f\u7528\u65b9\u5f0f"}),"\n",(0,a.jsxs)(t.p,{children:["\u9996\u5148\u914d\u7f6e client/server \u5bf9\u5e94\u7684 middleware/metadata \u63d2\u4ef6\uff0c\u7136\u540e\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4f20\u9012 key prefix\uff0c\u6216\u8005\u5143\u4fe1\u606f\u5e38\u91cf\uff0c\u4f8b\u5982 caller\u3002\n\u7136\u540e\u53ef\u4ee5\u901a\u8fc7\u5143\u4fe1\u606f\u5305\u4e2d\u7684 ",(0,a.jsx)(t.code,{children:"NewClientContext"})," \u6216\u8005 ",(0,a.jsx)(t.code,{children:"FromServerContext"})," \u8fdb\u884c\u914d\u7f6e\u6216\u8005\u83b7\u53d6\u3002"]}),"\n",(0,a.jsx)(t.h4,{id:"\u6ce8\u518c\u5143\u4fe1\u606f\u4e2d\u95f4\u4ef6",children:"\u6ce8\u518c\u5143\u4fe1\u606f\u4e2d\u95f4\u4ef6"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",children:'// https://github.com/go-kratos/examples/tree/main/metadata\n\n// \u6ce8\u518c\u5143\u4fe1\u606f\u4e2d\u95f4\u4ef6\u5230 gRPC \u6216 HTTP \u7684 server \u6216 client \u4e2d\n\n// server\ngrpcSrv := grpc.NewServer(\n\tgrpc.Address(":9000"),\n\tgrpc.Middleware(\n\t\tmetadata.Server(),\n\t),\n)\nhttpSrv := http.NewServer(\n\thttp.Address(":8000"),\n\thttp.Middleware(\n\t\tmetadata.Server(),\n\t),\n)\n\n// client\nconn, err := grpc.DialInsecure(\n\tcontext.Background(),\n\tgrpc.WithEndpoint("127.0.0.1:9000"),\n\tgrpc.WithMiddleware(\n\t\tmetadata.Client(),\n\t),\n)\n'})}),"\n",(0,a.jsx)(t.h4,{id:"\u83b7\u53d6\u5143\u4fe1\u606f\u5b57\u6bb5\u7684\u503c",children:"\u83b7\u53d6\u5143\u4fe1\u606f\u5b57\u6bb5\u7684\u503c"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",children:'if md, ok := metadata.FromServerContext(ctx); ok {\n\textra = md.Get("x-md-global-extra")\n}\n'})}),"\n",(0,a.jsx)(t.h4,{id:"\u8bbe\u7f6e\u5143\u4fe1\u606f\u5b57\u6bb5\u7684\u503c",children:"\u8bbe\u7f6e\u5143\u4fe1\u606f\u5b57\u6bb5\u7684\u503c"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-go",children:'ctx = metadata.AppendToClientContext(ctx, "x-md-global-extra", "2233")\n'})})]})}function m(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(s,{...e})}):s(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>d,x:()=>c});var r=n(6540);const a={},o=r.createContext(a);function d(e){const t=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function c(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:d(e.components),r.createElement(o.Provider,{value:t},e.children)}}}]);