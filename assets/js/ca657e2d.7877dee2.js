"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[1562],{8453:(e,i,t)=>{t.d(i,{R:()=>l,x:()=>s});var r=t(6540);const n={},o=r.createContext(n);function l(e){const i=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(i):{...i,...e}},[i,e])}function s(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:l(e.components),r.createElement(o.Provider,{value:i},e.children)}},8672:(e,i,t)=>{t.r(i),t.d(i,{assets:()=>a,contentTitle:()=>s,default:()=>m,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"component/middleware/ratelimit","title":"\u9650\u6d41\u5668","description":"\u9650\u6d41\u5668\u4e2d\u95f4\u4ef6\uff0c\u7528\u4e8e\u670d\u52a1\u7aef\u6d41\u91cf\u63a7\u5236\uff0c\u9ed8\u8ba4\u4f7f\u7528bbr limiter\u7b97\u6cd5\u3002","source":"@site/docs/component/middleware/06-ratelimit.md","sourceDirName":"component/middleware","slug":"/component/middleware/ratelimit","permalink":"/docs/component/middleware/ratelimit","draft":false,"unlisted":false,"editUrl":"https://github.com/go-kratos/go-kratos.dev/edit/main/docs/component/middleware/06-ratelimit.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"id":"ratelimit","title":"\u9650\u6d41\u5668","keywords":["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},"sidebar":"docs","previous":{"title":"\u76d1\u63a7","permalink":"/docs/component/middleware/metrics"},"next":{"title":"\u5f02\u5e38\u6062\u590d","permalink":"/docs/component/middleware/recovery"}}');var n=t(4848),o=t(8453);const l={id:"ratelimit",title:"\u9650\u6d41\u5668",keywords:["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},s=void 0,a={},c=[{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:3},{value:"<code>WithLimiter</code>",id:"withlimiter",level:4},{value:"\u4f7f\u7528\u65b9\u6cd5",id:"\u4f7f\u7528\u65b9\u6cd5",level:3},{value:"\u5728 Server \u4e2d\u914d\u7f6e\u4f7f\u7528\u9650\u6d41\u5668",id:"\u5728-server-\u4e2d\u914d\u7f6e\u4f7f\u7528\u9650\u6d41\u5668",level:4},{value:"\u89e6\u53d1\u9650\u6d41",id:"\u89e6\u53d1\u9650\u6d41",level:4}];function d(e){const i={a:"a",code:"code",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(i.p,{children:["\u9650\u6d41\u5668\u4e2d\u95f4\u4ef6\uff0c\u7528\u4e8e\u670d\u52a1\u7aef\u6d41\u91cf\u63a7\u5236\uff0c\u9ed8\u8ba4\u4f7f\u7528",(0,n.jsx)(i.a,{href:"https://github.com/go-kratos/aegis/tree/main/ratelimit/bbr",children:"bbr limiter"}),"\u7b97\u6cd5\u3002"]}),"\n",(0,n.jsx)(i.h3,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,n.jsx)(i.h4,{id:"withlimiter",children:(0,n.jsx)(i.code,{children:"WithLimiter"})}),"\n",(0,n.jsx)(i.p,{children:"\u66ff\u6362\u9ed8\u8ba4\u7684\u9650\u6d41\u7b97\u6cd5"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-go",children:"// WithLimiter set Limiter implementation,\n// default is bbr limiter\nfunc WithLimiter(limiter ratelimit.Limiter) Option {\n    return func(o *options) {\n        o.limiter = limiter\n    }\n}\n"})}),"\n",(0,n.jsxs)(i.p,{children:["\u6240\u63d0\u4f9b\u7684\u9650\u6d41\u5668\u9700\u8981\u5b9e\u73b0 ",(0,n.jsx)(i.code,{children:"aegis"})," \u7684 ",(0,n.jsx)(i.code,{children:"Limiter"})," \u63a5\u53e3\uff0c\u66f4\u591a\u4fe1\u606f\u53ef\u4ee5\u53c2\u8003",(0,n.jsx)(i.a,{href:"https://github.com/go-kratos/aegis/blob/main/ratelimit/ratelimit.go",children:"aegis/ratelimit"}),"\u3002"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-go",children:"// Limiter is a rate limiter.\ntype Limiter interface {\n    Allow() (DoneFunc, error)\n}\n"})}),"\n",(0,n.jsx)(i.h3,{id:"\u4f7f\u7528\u65b9\u6cd5",children:"\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,n.jsx)(i.h4,{id:"\u5728-server-\u4e2d\u914d\u7f6e\u4f7f\u7528\u9650\u6d41\u5668",children:"\u5728 Server \u4e2d\u914d\u7f6e\u4f7f\u7528\u9650\u6d41\u5668"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-go",children:"var opts = []http.ServerOption{\n    http.Middleware(\n        // \u9ed8\u8ba4 bbr limiter\n        ratelimit.Server(),\n        // \u81ea\u5b9a\u4e49 limiter\n        //ratelimit.Server(ratelimit.WithLimiter(limiter)),\n    ),\n}\n\nsrv := http.NewServer(opts...)\n"})}),"\n",(0,n.jsx)(i.h4,{id:"\u89e6\u53d1\u9650\u6d41",children:"\u89e6\u53d1\u9650\u6d41"}),"\n",(0,n.jsxs)(i.p,{children:["\u5f53\u89e6\u53d1\u9650\u6d41\u5668\u65f6\uff0c\u4f1a\u76f4\u63a5\u62d2\u7edd\u5f53\u524d\u8bf7\u6c42\uff0c\u5e76\u8fd4\u56de\u9519\u8bef",(0,n.jsx)(i.code,{children:"ErrLimitExceed"}),"\uff0c\u5b9a\u4e49\u5982\u4e0b\uff1a"]}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-go",children:'// ErrLimitExceed is service unavailable due to rate limit exceeded.\nvar ErrLimitExceed = errors.New(429, "RATELIMIT", "service unavailable due to rate limit exceeded")\n'})})]})}function m(e={}){const{wrapper:i}={...(0,o.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}}}]);