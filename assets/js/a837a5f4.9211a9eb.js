"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[286],{6019:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>a,toc:()=>d});const a=JSON.parse('{"id":"component/middleware/validate","title":"\u53c2\u6570\u6821\u9a8c","description":"Validate \u4e2d\u95f4\u4ef6\u4f7f\u7528 proto-gen-validate \u751f\u6210\u540e\u7684\u4ee3\u7801\u8fdb\u884c\u53c2\u6570\u6821\u9a8c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5728 proto \u4e2d\u7f16\u5199\u53c2\u6570\u6821\u9a8c\u89c4\u5219\uff0c\u7136\u540e\u751f\u6210\u4ee3\u7801\uff0c\u901a\u8fc7\u4e2d\u95f4\u4ef6\u81ea\u52a8\u7684\u8fdb\u884c\u6821\u9a8c\u3002","source":"@site/docs/component/middleware/09-validate.md","sourceDirName":"component/middleware","slug":"/component/middleware/validate","permalink":"/docs/component/middleware/validate","draft":false,"unlisted":false,"editUrl":"https://github.com/go-kratos/go-kratos.dev/edit/main/docs/component/middleware/09-validate.md","tags":[],"version":"current","sidebarPosition":9,"frontMatter":{"id":"validate","title":"\u53c2\u6570\u6821\u9a8c","keywords":["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},"sidebar":"docs","previous":{"title":"\u94fe\u8def\u8ffd\u8e2a","permalink":"/docs/component/middleware/tracing"},"next":{"title":"\u4f20\u8f93\u534f\u8bae","permalink":"/docs/category/\u4f20\u8f93\u534f\u8bae"}}');var r=t(4848),l=t(8453);const i={id:"validate",title:"\u53c2\u6570\u6821\u9a8c",keywords:["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},o=void 0,s={},d=[{value:"\u5b89\u88c5\u5de5\u5177",id:"\u5b89\u88c5\u5de5\u5177",level:3},{value:"\u89c4\u5219\u793a\u4f8b",id:"\u89c4\u5219\u793a\u4f8b",level:3},{value:"\u6570\u5b57\u7c7b\u578b",id:"\u6570\u5b57\u7c7b\u578b",level:3},{value:"\u5e03\u5c14\u7c7b\u578b",id:"\u5e03\u5c14\u7c7b\u578b",level:4},{value:"\u6587\u672c\u7c7b\u578b",id:"\u6587\u672c\u7c7b\u578b",level:4},{value:"\u6d88\u606f\u4f53",id:"\u6d88\u606f\u4f53",level:4},{value:"\u751f\u6210\u4ee3\u7801",id:"\u751f\u6210\u4ee3\u7801",level:3},{value:"\u642d\u914d\u4e2d\u95f4\u4ef6\u4f7f\u7528",id:"\u642d\u914d\u4e2d\u95f4\u4ef6\u4f7f\u7528",level:3},{value:"http",id:"http",level:4},{value:"grpc",id:"grpc",level:4},{value:"References",id:"references",level:3}];function c(e){const n={a:"a",code:"code",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.p,{children:"Validate \u4e2d\u95f4\u4ef6\u4f7f\u7528 proto-gen-validate \u751f\u6210\u540e\u7684\u4ee3\u7801\u8fdb\u884c\u53c2\u6570\u6821\u9a8c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5728 proto \u4e2d\u7f16\u5199\u53c2\u6570\u6821\u9a8c\u89c4\u5219\uff0c\u7136\u540e\u751f\u6210\u4ee3\u7801\uff0c\u901a\u8fc7\u4e2d\u95f4\u4ef6\u81ea\u52a8\u7684\u8fdb\u884c\u6821\u9a8c\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u5b89\u88c5\u5de5\u5177",children:"\u5b89\u88c5\u5de5\u5177"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u4f7f\u7528 validate \u4e4b\u524d\u9996\u5148\u9700\u8981\u5b89\u88c5 ",(0,r.jsx)(n.a,{href:"https://github.com/envoyproxy/protoc-gen-validate",children:"proto-gen-validate"}),"\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"go install github.com/envoyproxy/protoc-gen-validate@latest\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5982\u679c\u4f7f\u7528\u4e2d\u9047\u5230\u65e0\u6cd5\u4f7f\u7528\u6216\u8005\u751f\u6210\u7684\u4ee3\u7801\u4e2d \u5305\u542b ",(0,r.jsx)(n.code,{children:"// no validation rules for xxxx"})]}),"\n",(0,r.jsxs)(n.p,{children:["\u53ef\u4ee5\u5c1d\u8bd5 ",(0,r.jsx)(n.code,{children:"git clone github.com/envoyproxy/protoc-gen-validate"})," \u7136\u540e ",(0,r.jsx)(n.code,{children:"make build"})]}),"\n",(0,r.jsx)(n.h3,{id:"\u89c4\u5219\u793a\u4f8b",children:"\u89c4\u5219\u793a\u4f8b"}),"\n",(0,r.jsxs)(n.p,{children:["\u4e0b\u9762\u4e3a\u5927\u5bb6\u5217\u4e3e\u51e0\u79cd\u5e38\u7528\u7c7b\u578b\u7684\u53c2\u6570\u6821\u9a8c\u793a\u4f8b\uff0c\u66f4\u591a\u7684\u793a\u4f8b\u53ef\u4ee5\u5728 ",(0,r.jsx)(n.a,{href:"https://github.com/envoyproxy/protoc-gen-validate",children:"proto-gen-validate"})," \u6587\u6863\u4e2d\u67e5\u770b\u3002"]}),"\n",(0,r.jsx)(n.h3,{id:"\u6570\u5b57\u7c7b\u578b",children:"\u6570\u5b57\u7c7b\u578b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-protobuf",children:"// \u53c2\u6570\u5fc5\u987b\u5927\u4e8e 0\nint64 id = 1 [(validate.rules).int64 = {gt: 0}];\n// \u53c2\u6570\u5fc5\u987b\u5728 0 \u5230 120 \u4e4b\u95f4\nint32 age = 2 [(validate.rules).int32 = {gt:0, lte: 120}];\n// \u53c2\u6570\u662f 1 \u6216 2 \u6216 3\nuint32 code = 3 [(validate.rules).uint32 = {in: [1,2,3]}];\n// \u53c2\u6570\u4e0d\u80fd\u662f 0 \u6216 99.99\nfloat score = 1 [(validate.rules).float = {not_in: [0, 99.99]}];\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u5e03\u5c14\u7c7b\u578b",children:"\u5e03\u5c14\u7c7b\u578b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-protobuf",children:"// \u53c2\u6570\u5fc5\u987b\u4e3a true\nbool state = 5 [(validate.rules).bool.const = true];\n// \u53c2\u6570\u5fc5\u987b\u4e3a false\nbool state = 5 [(validate.rules).bool.const = false];\n"})}),"\n",(0,r.jsx)(n.h4,{id:"\u6587\u672c\u7c7b\u578b",children:"\u6587\u672c\u7c7b\u578b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-protobuf",children:'// \u53c2\u6570\u5fc5\u987b\u4e3a /hello\nstring path = 6 [(validate.rules).string.const = "/hello"];\n// \u53c2\u6570\u6587\u672c\u957f\u5ea6\u5fc5\u987b\u4e3a 11\nstring phone = 7 [(validate.rules).string.len = 11];\n// \u53c2\u6570\u6587\u672c\u957f\u5ea6\u4e0d\u80fd\u5c0f\u4e8e 10 \u4e2a\u5b57\u7b26\nstring explain = 8 [(validate.rules).string.min_len =  10];\n// \u53c2\u6570\u6587\u672c\u957f\u5ea6\u4e0d\u80fd\u5c0f\u4e8e 1 \u4e2a\u5b57\u7b26\u5e76\u4e14\u4e0d\u80fd\u5927\u4e8e 10 \u4e2a\u5b57\u7b26\nstring name = 9 [(validate.rules).string = {min_len: 1, max_len: 10}];\n// \u53c2\u6570\u6587\u672c\u4f7f\u7528\u6b63\u5219\u5339\u914d,\u5339\u914d\u5fc5\u987b\u662f\u975e\u7a7a\u7684\u4e0d\u533a\u5206\u5927\u5c0f\u5199\u7684\u5341\u516d\u8fdb\u5236\u5b57\u7b26\u4e32\nstring card = 10 [(validate.rules).string.pattern = "(?i)^[0-9a-f]+$"];\n// \u53c2\u6570\u6587\u672c\u5fc5\u987b\u662f email \u683c\u5f0f\nstring email = 11 [(validate.rules).string.email = true];\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u6d88\u606f\u4f53",children:"\u6d88\u606f\u4f53"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-protobuf",children:"// \u53c2\u6570\u4e3a\u5fc5\u586b\u9879\nInfo info = 11 [(validate.rules).message.required = true];\nmessage Info {\n    string address = 1;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u751f\u6210\u4ee3\u7801",children:"\u751f\u6210\u4ee3\u7801"}),"\n",(0,r.jsxs)(n.p,{children:["1.\u76f4\u63a5\u4f7f\u7528",(0,r.jsx)(n.code,{children:"protoc"}),"\u751f\u6210"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"protoc --proto_path=. \\\n           --proto_path=./third_party \\\n           --go_out=paths=source_relative:. \\\n           --validate_out=paths=source_relative,lang=go:. \\\n           xxxx.proto\n"})}),"\n",(0,r.jsxs)(n.p,{children:["2.\u5728Makefile\u4e2d\u6dfb\u52a0",(0,r.jsx)(n.code,{children:"validate"}),"\u547d\u4ee4"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-makefile",children:".PHONY: validate\n# generate validate proto\nvalidate:\n\tprotoc --proto_path=. \\\n           --proto_path=./third_party \\\n           --go_out=paths=source_relative:. \\\n           --validate_out=paths=source_relative,lang=go:. \\\n           $(API_PROTO_FILES)\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u6267\u884c\u547d\u4ee4"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"make validate\n"})}),"\n",(0,r.jsx)(n.h3,{id:"\u642d\u914d\u4e2d\u95f4\u4ef6\u4f7f\u7528",children:"\u642d\u914d\u4e2d\u95f4\u4ef6\u4f7f\u7528"}),"\n",(0,r.jsx)(n.p,{children:"\u6211\u4eec\u53ef\u4ee5\u5c06 validate \u4e2d\u95f4\u4ef6\u6ce8\u5165\u5230 http \u6216\u8005 grpc \u4e2d\uff0c\u5728\u6709\u8bf7\u6c42\u8fdb\u5165\u65f6 validate \u4e2d\u95f4\u4ef6\u4f1a\u81ea\u52a8\u5bf9\u53c2\u6570\u6839\u636e proto \u4e2d\u7f16\u5199\u7684\u89c4\u5219\u8fdb\u884c\u6821\u9a8c\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"http",children:"http"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'httpSrv := http.NewServer(\n\thttp.Address(":8000"),\n\thttp.Middleware(\n\t\tvalidate.Validator(),\n\t))\n'})}),"\n",(0,r.jsx)(n.h4,{id:"grpc",children:"grpc"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-go",children:'grpcSrv := grpc.NewServer(\n\tgrpc.Address(":9000"),\n\tgrpc.Middleware(\n\t\tvalidate.Validator(),\n\t))\n'})}),"\n",(0,r.jsx)(n.h3,{id:"references",children:"References"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/go-kratos/examples/tree/main/validate",children:"https://github.com/go-kratos/examples/tree/main/validate"})}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var a=t(6540);const r={},l=a.createContext(r);function i(e){const n=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(l.Provider,{value:n},e.children)}}}]);