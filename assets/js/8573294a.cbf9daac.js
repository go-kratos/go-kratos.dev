"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[2586],{4086:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>i,metadata:()=>n,toc:()=>s});const n=JSON.parse('{"id":"component/middleware/recovery","title":"\u5f02\u5e38\u6062\u590d","description":"Recovery \u4e2d\u95f4\u4ef6\u7528\u4e8e\u5f02\u5e38\u6062\u590d\uff0c\u670d\u52a1\u51fa\u73b0\u5f02\u5e38\u7684\u60c5\u51b5\u4e0b\uff0c\u9632\u6b62\u7a0b\u5e8f\u76f4\u63a5\u9000\u51fa\u3002","source":"@site/docs/component/middleware/07-recovery.md","sourceDirName":"component/middleware","slug":"/component/middleware/recovery","permalink":"/docs/component/middleware/recovery","draft":false,"unlisted":false,"editUrl":"https://github.com/go-kratos/go-kratos.dev/edit/main/docs/component/middleware/07-recovery.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"id":"recovery","title":"\u5f02\u5e38\u6062\u590d","keywords":["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},"sidebar":"docs","previous":{"title":"\u9650\u6d41\u5668","permalink":"/docs/component/middleware/ratelimit"},"next":{"title":"\u94fe\u8def\u8ffd\u8e2a","permalink":"/docs/component/middleware/tracing"}}');var o=r(4848),c=r(8453);const i={id:"recovery",title:"\u5f02\u5e38\u6062\u590d",keywords:["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},d=void 0,l={},s=[{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:3},{value:"<code>WithHandler()</code>",id:"withhandler",level:4},{value:"<code>WithLogger()</code>",id:"withlogger",level:4},{value:"\u4f7f\u7528\u65b9\u6cd5",id:"\u4f7f\u7528\u65b9\u6cd5",level:3},{value:"http",id:"http",level:4},{value:"grpc",id:"grpc",level:4}];function a(e){const t={code:"code",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,c.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"Recovery \u4e2d\u95f4\u4ef6\u7528\u4e8e\u5f02\u5e38\u6062\u590d\uff0c\u670d\u52a1\u51fa\u73b0\u5f02\u5e38\u7684\u60c5\u51b5\u4e0b\uff0c\u9632\u6b62\u7a0b\u5e8f\u76f4\u63a5\u9000\u51fa\u3002"}),"\n",(0,o.jsx)(t.h3,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,o.jsxs)(t.p,{children:["Recovery \u4e2d\u95f4\u4ef6\u4e2d\u63d0\u4f9b\u4e86\u4e24\u4e2a\u914d\u7f6e\u65b9\u6cd5 ",(0,o.jsx)(t.code,{children:"WithHandler()"})," \u548c ",(0,o.jsx)(t.code,{children:"WithLogger()"}),"\u3002"]}),"\n",(0,o.jsx)(t.h4,{id:"withhandler",children:(0,o.jsx)(t.code,{children:"WithHandler()"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:"func WithHandler(h HandlerFunc) Option {\n\treturn func(o *options) {\n\t\to.handler = h\n\t}\n}\n"})}),"\n",(0,o.jsxs)(t.p,{children:["\u7528\u4e8e\u8bbe\u7f6e\u670d\u52a1\u5f02\u5e38\u65f6\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684 ",(0,o.jsx)(t.code,{children:"handler"})," \u8fdb\u884c\u5904\u7406\uff0c\u4f8b\u5982\u6295\u9012\u5f02\u5e38\u4fe1\u606f\u5230 sentry\u3002"]}),"\n",(0,o.jsx)(t.h4,{id:"withlogger",children:(0,o.jsx)(t.code,{children:"WithLogger()"})}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:"func WithLogger(logger log.Logger) Option {\n\treturn func(o *options) {\n\t\to.logger = logger\n\t}\n}\n"})}),"\n",(0,o.jsxs)(t.p,{children:["\u7528\u4e8e\u8bbe\u7f6e\u4e2d\u95f4\u4ef6\u6253\u5370\u65e5\u5fd7\u65f6\u4f7f\u7528\u7684 ",(0,o.jsx)(t.code,{children:"logger"}),"\u3002"]}),"\n",(0,o.jsx)(t.h3,{id:"\u4f7f\u7528\u65b9\u6cd5",children:"\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,o.jsx)(t.h4,{id:"http",children:"http"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:"var opts = []http.ServerOption{\n\thttp.Middleware(\n\t\trecovery.Recovery(\n      recovery.WithLogger(log.DefaultLogger),\n\t\t\trecovery.WithHandler(func(ctx context.Context, req, err interface{}) error {\n\t\t\t\t\t// do someting\n\t\t\t\t\treturn nil\n\t\t\t}),\n    ),\n\t),\n}\nsrv := http.NewServer(opts...)\n"})}),"\n",(0,o.jsx)(t.h4,{id:"grpc",children:"grpc"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-go",children:"var opts = []grpc.ServerOption{\n\tgrpc.Middleware(\n\t\trecovery.Recovery(\n\t\t\trecovery.WithLogger(log.DefaultLogger),\n\t\t\trecovery.WithHandler(func(ctx context.Context, req, err interface{}) error {\n\t\t\t\t// do someting\n\t\t\t\treturn nil\n\t\t\t}),\n\t\t),\n\t),\n}\nsrv := grpc.NewServer(opts...)\n"})})]})}function h(e={}){const{wrapper:t}={...(0,c.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},8453:(e,t,r)=>{r.d(t,{R:()=>i,x:()=>d});var n=r(6540);const o={},c=n.createContext(o);function i(e){const t=n.useContext(c);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),n.createElement(c.Provider,{value:t},e.children)}}}]);