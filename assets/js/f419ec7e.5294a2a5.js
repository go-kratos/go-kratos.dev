"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5011],{2627:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>c,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"component/middleware/circuitbreaker","title":"\u7194\u65ad\u5668","description":"\u7194\u65ad\u5668\u4e2d\u95f4\u4ef6\uff0c\u7528\u4e8e\u63d0\u4f9b\u5ba2\u6237\u7aef\u7194\u65ad\u529f\u80fd\uff0c\u9ed8\u8ba4\u5b9e\u73b0\u4e86sre breaker \u7b97\u6cd5\u3002","source":"@site/docs/component/middleware/03-circuitbreaker.md","sourceDirName":"component/middleware","slug":"/component/middleware/circuitbreaker","permalink":"/docs/component/middleware/circuitbreaker","draft":false,"unlisted":false,"editUrl":"https://github.com/go-kratos/go-kratos.dev/edit/main/docs/component/middleware/03-circuitbreaker.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"id":"circuitbreaker","title":"\u7194\u65ad\u5668","keywords":["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},"sidebar":"docs","previous":{"title":"\u8ba4\u8bc1","permalink":"/docs/component/middleware/auth"},"next":{"title":"\u65e5\u5fd7","permalink":"/docs/component/middleware/logging"}}');var i=n(4848),o=n(8453);const c={id:"circuitbreaker",title:"\u7194\u65ad\u5668",keywords:["Go","Kratos","Toolkit","Framework","Microservices","Protobuf","gRPC","HTTP"]},s=void 0,d={},a=[{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:3},{value:"<code>WithGroup</code>",id:"withgroup",level:4},{value:"\u4f7f\u7528\u65b9\u6cd5",id:"\u4f7f\u7528\u65b9\u6cd5",level:3},{value:"\u5728 Client \u8bf7\u6c42\u4e2d\u4f7f\u7528\u7194\u65ad\u5668",id:"\u5728-client-\u8bf7\u6c42\u4e2d\u4f7f\u7528\u7194\u65ad\u5668",level:4},{value:"\u89e6\u53d1\u7194\u65ad",id:"\u89e6\u53d1\u7194\u65ad",level:4}];function l(e){const r={a:"a",code:"code",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(r.p,{children:["\u7194\u65ad\u5668\u4e2d\u95f4\u4ef6\uff0c\u7528\u4e8e\u63d0\u4f9b\u5ba2\u6237\u7aef\u7194\u65ad\u529f\u80fd\uff0c\u9ed8\u8ba4\u5b9e\u73b0\u4e86",(0,i.jsx)(r.a,{href:"https://github.com/go-kratos/aegis/tree/main/circuitbreaker/sre",children:"sre breaker"})," \u7b97\u6cd5\u3002"]}),"\n",(0,i.jsx)(r.h3,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,i.jsx)(r.h4,{id:"withgroup",children:(0,i.jsx)(r.code,{children:"WithGroup"})}),"\n",(0,i.jsxs)(r.p,{children:["breaker \u4f9d\u8d56\u4e8e  ",(0,i.jsx)(r.code,{children:"container/group"}),"  \u6765\u5b9e\u73b0\u5bf9\u4e8e\u9488\u5bf9\u4e0d\u540c ",(0,i.jsx)(r.code,{children:"Operation"})," \u4f7f\u7528\u4e92\u76f8\u72ec\u7acb\u7684 breaker\u3002\n",(0,i.jsx)(r.code,{children:"WithGroup"})," \u53ef\u4ee5\u914d\u7f6e\u81ea\u5b9a\u4e49\u7684 ",(0,i.jsx)(r.code,{children:"Breaker"})," \u6765\u66ff\u6362\u9ed8\u8ba4\u7684\u7194\u65ad\u7b97\u6cd5\uff1a"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"// WithGroup with circuit breaker group.\n// NOTE: implements generics circuitbreaker.CircuitBreaker\nfunc WithGroup(g *group.Group) Option {\n\treturn func(o *options) {\n\t\to.group = g\n\t}\n}\n"})}),"\n",(0,i.jsxs)(r.p,{children:["\u9ed8\u8ba4\u914d\u7f6e\u4f1a\u9488\u5bf9\u4e0d\u540c\u7684 ",(0,i.jsx)(r.code,{children:"Operation"})," \u751f\u6210\u72ec\u7acb\u7684 breaker\uff1a"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"opt := &options{\n\tgroup: group.NewGroup(func() interface{} {\n\t\treturn sre.NewBreaker()\n\t}),\n}\n"})}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"group.Group"})," \u662f\u4e00\u4e2a ",(0,i.jsx)(r.code,{children:"\u61d2\u52a0\u8f7d\u5bb9\u5668"})," \u5728\u672c\u6587\u4e2d\u88c5\u8f7d\u8fdb ",(0,i.jsx)(r.strong,{children:"group.Group"})," \u7684\u5b9e\u4f8b\uff0c\u5e94\u5b9e\u73b0 ",(0,i.jsx)(r.code,{children:"aegis/circuitbreaker"})," \u7684 ",(0,i.jsx)(r.strong,{children:"CircuitBreaker"})," \u63a5\u53e3\u3002"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:"// CircuitBreaker is a circuit breaker.\ntype CircuitBreaker interface {\n\tAllow() error // \u5224\u65ad\u8bf7\u6c42\u662f\u5426\u5141\u8bb8\u53d1\u9001,\u5982\u679c\u8fd4\u56de error \u5219\u8868\u793a\u8bf7\u6c42\u88ab\u62d2\u7edd\n  \tMarkSuccess() // \u6807\u8bb0\u8bf7\u6c42\u6210\u529f\n\tMarkFailed() // \u6807\u8bb0\u8bf7\u6c42\u5931\u8d25\n}\n"})}),"\n",(0,i.jsx)(r.h3,{id:"\u4f7f\u7528\u65b9\u6cd5",children:"\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,i.jsx)(r.h4,{id:"\u5728-client-\u8bf7\u6c42\u4e2d\u4f7f\u7528\u7194\u65ad\u5668",children:"\u5728 Client \u8bf7\u6c42\u4e2d\u4f7f\u7528\u7194\u65ad\u5668"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'// http\nconn, err := http.NewClient(\n\tcontext.Background(),\n\thttp.WithMiddleware(\n\t\tcircuitbreaker.Client(),\n\t),\n\thttp.WithEndpoint("127.0.0.1:8000"),\n)\n// grpc \nconn,err := transgrpc.Dial(\n  context.Background(), \n\tgrpc.WithMiddleware(\n\t\tcircuitbreaker.Client(),\n\t),\n  grpc.WithEndpoint("127.0.0.1:9000"),\n)\n'})}),"\n",(0,i.jsx)(r.h4,{id:"\u89e6\u53d1\u7194\u65ad",children:"\u89e6\u53d1\u7194\u65ad"}),"\n",(0,i.jsxs)(r.p,{children:["\u5f53\u7194\u65ad\u5668\u89e6\u53d1\u65f6\uff0c\u4f1a\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u5bf9\u4e8e\u8be5",(0,i.jsx)(r.code,{children:"Operation"}),"\u7684\u8c03\u7528\u5feb\u901f\u5931\u8d25\uff0c\u5e76\u8fd4\u56de\u9519\u8bef",(0,i.jsx)(r.code,{children:"ErrNotAllowed"}),"\uff0c\u5b9a\u4e49\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-go",children:'// ErrNotAllowed is request failed due to circuit breaker triggered.\nvar ErrNotAllowed = errors.New(503, "CIRCUITBREAKER", "request failed due to circuit breaker triggered")\n'})})]})}function u(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>c,x:()=>s});var t=n(6540);const i={},o=t.createContext(i);function c(e){const r=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(o.Provider,{value:r},e.children)}}}]);