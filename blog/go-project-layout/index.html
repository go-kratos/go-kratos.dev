<!doctype html>
<html lang="zh" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Go工程化 - Project Layout 最佳实践 | Kratos</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://go-kratos.dev/blog/go-project-layout"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Go工程化 - Project Layout 最佳实践 | Kratos"><meta data-rh="true" name="description" content="Go 项目工程化/基础库，在项目不同角度中的设计理念，Go 是一个面向包名设计的语言，可以通过各个包名进行组织 Go 的项目布局"><meta data-rh="true" property="og:description" content="Go 项目工程化/基础库，在项目不同角度中的设计理念，Go 是一个面向包名设计的语言，可以通过各个包名进行组织 Go 的项目布局"><meta data-rh="true" name="keywords" content="Go,Kratos,Toolkit,Framework,Microservices,Protobuf,gRPC,HTTP"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2021-03-08T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/tonybase"><meta data-rh="true" property="article:tag" content="go,golang,工程化,项目布局,最佳实践"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://go-kratos.dev/blog/go-project-layout"><link data-rh="true" rel="alternate" href="https://go-kratos.dev/blog/go-project-layout" hreflang="zh"><link data-rh="true" rel="alternate" href="https://go-kratos.dev/en/blog/go-project-layout" hreflang="en"><link data-rh="true" rel="alternate" href="https://go-kratos.dev/blog/go-project-layout" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Kratos RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Kratos Atom Feed"><link rel="stylesheet" href="/assets/css/styles.b4e95965.css">
<link rel="preload" href="/assets/js/runtime~main.752e043b.js" as="script">
<link rel="preload" href="/assets/js/main.41ba99e7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Kratos Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Kratos Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Kratos</b></a><a class="navbar__item navbar__link" href="/docs/">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a href="https://pkg.go.dev/github.com/go-kratos/kratos/v2/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/go-kratos/kratos/releases" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Changelog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文</a><ul class="dropdown__menu"><li><a href="/blog/go-project-layout" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh">中文</a></li><li><a href="/en/blog/go-project-layout" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en">English</a></li></ul></div><a href="https://github.com/go-kratos/kratos" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="搜索" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/go-project-wire">Go工程化 - 依赖注入</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/go-kratos-opentelemetry-practice">Kratos 学习笔记 - 基于 OpenTelemetry 的链路追踪</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/go-layout-operation-process">Kratos 学习笔记 - 通过 layout 简单分析应用是如何跑起来的</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog/go-project-layout">Go工程化 - Project Layout 最佳实践</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Go工程化 - Project Layout 最佳实践</h1><div class="container_mt6G margin-vert--md"><time datetime="2021-03-08T00:00:00.000Z" itemprop="datePublished">2021年3月8日</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/tonybase" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/3871120?s=460&amp;v=4" alt="Tony"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tonybase" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Tony</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of go-kratos</small></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="介绍">介绍<a class="hash-link" href="#介绍" title="Direct link to heading">​</a></h2><p>这篇文章主要讲 <strong>Go 项目工程化</strong> 上的一些思考，以及 <strong>Kratos</strong> 在项目不同角度中的设计理念。</p><p>Go 是一个面向包名设计的语言，可以通过各个包名进行组织 Go 的项目布局，而大家遵循规范设计准则，可以很好地改善团队成员之间的沟通。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="项目布局">项目布局<a class="hash-link" href="#项目布局" title="Direct link to heading">​</a></h2><p>每个公司都应当为不同的微服务建立一个统一的 Kit 工具包项目（基础库/框架）和 Application 项目。
基础库 Kit 为独立项目，公司级建议只有一个，按照功能目录来拆分会带来不少的管理工作，因此建议合并整合。</p><blockquote><p>by Package Oriented Design
“To this end, the Kit project is not allowed to have a vendor folder. If any of packages are dependent on 3rd party packages, they must always build against the latest version of those dependences.”</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="kit-基础库">Kit 基础库<a class="hash-link" href="#kit-基础库" title="Direct link to heading">​</a></h3><p>将 Kit 项目作为公司的标准库，因此应该只有一个。并且 Kit 基础库也应该具备以下这些特点：</p><ul><li>简单：不过度设计，代码平实简单；</li><li>通用：通用业务开发所需要的基础库的功能；</li><li>高效：提高业务迭代的效率；</li><li>稳定：基础库可测试性高，覆盖率高，有线上实践安全可靠；</li><li>健壮：通过良好的基础库设计，减少错用；</li><li>高性能：性能高，但不特定为了性能做 hack 优化，引入 unsafe ；</li><li>扩展性：良好的接口设计，来扩展实现，或者通过新增基础库目录来扩展功能；</li><li>容错性：为失败设计，大量引入对 SRE 的理解，鲁棒性高；</li><li>工具链：包含大量工具链，比如辅助代码生成，lint 工具等等；</li></ul><p>以 Kratos 为例子，一个典型的 Kit 基础库 可能看起来像这样：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">github.com/go-kratos/kratos</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── cmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── docs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── internal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── examples</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── encoding</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── log</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── metrics</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── metadata</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── middleware</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── transport</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── registry</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── third_party</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── app.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── options.go</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── go.mod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── go.sum</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>注意：为了保证 Kit 基础库的可移植性，尽可能进行接口抽象，并且 go.mod 依赖第三方库也尽可能简单，然后再通过 plugins 进行扩展基础库，以满足不同的业务需求定制化。</p></blockquote><h3 class="anchor anchorWithStickyNavbar_LWe7" id="application-应用项目">Application 应用项目<a class="hash-link" href="#application-应用项目" title="Direct link to heading">​</a></h3><p>如果你尝试学习 Go，或者你正在为自己建立一个 PoC 或一个玩具项目，这个项目布局是没啥必要的。从一些非常简单的事情开始（一个 main.go 文件绰绰有余）。当有更多的人参与这个项目时，你将需要更多的结构，包括需要一个 Toolkit 来方便生成项目的模板，尽可能大家统一的工程目录布局。</p><img loading="lazy" src="/images/ddd.png" alt="kratos ddd" width="500px" class="img_ev3q"><p>例如，通过 Kratos 工具生成一个 Go工程化项目 模板：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># 创建项目模板</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kratos new helloworld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd helloworld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 拉取项目依赖</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">go mod download</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 生成proto模板</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kratos proto add api/helloworld/helloworld.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 生成client源码</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kratos proto client api/helloworld/helloworld.proto</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 生成server模板</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">kratos proto server api/helloworld/helloworld.proto -t internal/service</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 Kratos 中，一个典型的 Go 项目布局 可能看起来像这样：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">application</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|____api</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| |____helloworld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| | |____v1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| | |____errors</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|____cmd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| |____helloworld</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|____configs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|____internal</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| |____conf</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| |____data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| |____biz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| |____service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">| |____server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|____test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|____pkg</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|____go.mod</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|____go.sum</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|____LICENSE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">|____README.md</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="应用类型">应用类型<a class="hash-link" href="#应用类型" title="Direct link to heading">​</a></h3><p>微服务中的 app 服务类型主要分为5类：interface、service、job、admin、task，应用 cmd 目录负责程序的：启动、关闭、配置初始化等。</p><ul><li>interface: 对外的 BFF 服务，接受来自用户的请求，比如暴露了 HTTP/gRPC 接口。</li><li>service: 对内的微服务，仅接受来自内部其他服务或者网关的请求，比如暴露了gRPC 接口只对内服务。</li><li>admin：区别于 service，更多是面向运营测的服务，通常数据权限更高，隔离带来更好的代码级别安全。</li><li>job: 流式任务处理的服务，上游一般依赖 message broker。</li><li>task: 定时任务，类似 cronjob，部署到 task 托管平台中。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="应用目录">应用目录<a class="hash-link" href="#应用目录" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cmd">/cmd<a class="hash-link" href="#cmd" title="Direct link to heading">​</a></h3><p>本项目的主干。
每个应用程序的目录名应该与你想要的可执行文件的名称相匹配（例如，<code>/cmd/myapp</code>）。
不要在这个目录中放置太多代码。如果你认为代码可以导入并在其他项目中使用，那么它应该位于 <code>/pkg</code> 目录中。如果代码不是可重用的，或者你不希望其他人重用它，请将该代码放到 <code>/internal</code> 目录中。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="internal">/internal<a class="hash-link" href="#internal" title="Direct link to heading">​</a></h3><p>私有应用程序和库代码。这是你不希望其他人在其应用程序或库中导入代码。请注意，这个布局模式是由 Go 编译器本身执行的。有关更多细节，请参阅 Go 1.4 release notes。注意，你并不局限于顶级 <code>internal</code> 目录。在项目树的任何级别上都可以有多个内部目录。
你可以选择向 <code>internal</code> 包中添加一些额外的结构，以分隔共享和非共享的内部代码。这不是必需的(特别是对于较小的项目)，但是最好有有可视化的线索来显示预期的包的用途。你的实际应用程序代码可以放在 <code>/internal/app</code> 目录下（例如 <code>/internal/app/myapp</code>），这些应用程序共享的代码可以放在 <code>/internal/pkg</code> 目录下（例如 /internal/pkg/myprivlib）。
因为我们习惯把相关的服务，比如账号服务，内部有 rpc、job、admin 等，相关的服务整合一起后，需要区分 app。单一的服务，可以去掉 <code>/internal/myapp</code>。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pkg">/pkg<a class="hash-link" href="#pkg" title="Direct link to heading">​</a></h3><p>外部应用程序可以使用的库代码（例如 <code>/pkg/mypubliclib</code>）。其他项目会导入这些库，所以在这里放东西之前要三思:-)注意，<code>internal</code> 目录是确保私有包不可导入的更好方法，因为它是由 Go 强制执行的。<code>/pkg</code> 目录仍然是一种很好的方式，可以显式地表示该目录中的代码对于其他人来说是安全使用的好方法。</p><blockquote><p>/pkg 目录内，可以参考 go 标准库的组织方式，按照功能分类。/internal/pkg 一般用于项目内的 跨多个应用的公共共享代码，但其作用域仅在单个项目工程内。  </p></blockquote><p>由 Travis Jeffery  撰写的 I&#x27;ll take pkg over internal 博客文章提供了 <code>pkg</code> 和 <code>internal</code> 目录的一个很好的概述，以及什么时候使用它们是有意义的。
当根目录包含大量非 Go 组件和目录时，这也是一种将 Go 代码分组到一个位置的方法，这使得运行各种 Go 工具变得更加容易组织。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="服务应用目录">服务应用目录<a class="hash-link" href="#服务应用目录" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="api">/api<a class="hash-link" href="#api" title="Direct link to heading">​</a></h3><p>​API 协议定义目录，services.proto protobuf 文件，以及生成的 go 文件。我们通常把 api 文档直接在 proto 文件中描述。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configs">/configs<a class="hash-link" href="#configs" title="Direct link to heading">​</a></h3><p>​配置文件模板或默认配置。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="test">/test<a class="hash-link" href="#test" title="Direct link to heading">​</a></h3><p>​额外的外部测试应用程序和测试数据。你可以随时根据需求构造 /test 目录。对于较大的项目，有一个数据子目录是有意义的。例如，你可以使用 /test/data 或 /test/testdata (如果你需要忽略目录中的内容)。请注意，Go 还会忽略以 “.” 或 “_” 开头的目录或文件，因此在如何命名测试数据目录方面有更大的灵活性。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="服务内部目录">服务内部目录<a class="hash-link" href="#服务内部目录" title="Direct link to heading">​</a></h2><p>Application 目录下有 api、cmd、configs、internal、pkg 目录，目录里一般还会放置 README、CHANGELOG、OWNERS。</p><p>internal 是为了避免有同业务下有人跨目录引用了内部的 data、biz、service、server 等内部 struct。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="data">data<a class="hash-link" href="#data" title="Direct link to heading">​</a></h3><p>业务数据访问，包含 cache、db 等封装，实现了 biz 的 repo 接口。我们可能会把 data 与 dao 混淆在一起，data 偏重业务的含义，它所要做的是将领域对象重新拿出来，我们去掉了 DDD 的 infra 层。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="biz">biz<a class="hash-link" href="#biz" title="Direct link to heading">​</a></h3><p>业务逻辑的组装层，类似 DDD 的 domain 层，data 类似 DDD 的 repo，repo 接口在这里定义，使用依赖倒置的原则。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="service">service<a class="hash-link" href="#service" title="Direct link to heading">​</a></h3><p>实现了 api 定义的服务层，类似 DDD 的 application 层，处理 DTO 到 biz 领域实体的转换（DTO -&gt; DO），同时协同各类 biz 交互，但是不应处理复杂逻辑。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="server">server<a class="hash-link" href="#server" title="Direct link to heading">​</a></h3><p>为http和grpc实例的创建和配置，以及注册对应的 service 。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="不建议的目录">不建议的目录<a class="hash-link" href="#不建议的目录" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="src"><del>src/</del><a class="hash-link" href="#src" title="Direct link to heading">​</a></h3><p>  src 目录在 java 开发语言的项目中是一个常用的模式，但是在 go 开发项目中，尽量不要使用 src 目录。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="model"><del>model/</del><a class="hash-link" href="#model" title="Direct link to heading">​</a></h3><p>在其他语言开发中一个非常通用的模块叫 model，把所有类型都放在 model 里。但是在 go 里不建议的，因为 go 的包设计是根据功能职责划分的。比如一个 User 模型，应该声明在他被用的功能模块里。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="xxs"><del>xxs/</del><a class="hash-link" href="#xxs" title="Direct link to heading">​</a></h3><p>带复数的目录或包。虽然 go 源码中有 strings 包，但更多都是用单数形式。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="总结">总结<a class="hash-link" href="#总结" title="Direct link to heading">​</a></h2><p>在实际 go 项目开发中，一定要灵活运用，当然也可以完全不按照这样架构分层、包设计的规则，一切以项目的大小、业务的复杂度、个人专业技能认知的广度和深度、时间的紧迫度为准。</p><p>并且，一定要按实际情况，选择合适自己团队的 Kit 基础库，进行充分的调研以及是否可满足插件定制化，需要维护好属于团队的 Kit 基础库 和 代码规范 ，带动开发者进行积极参与贡献。</p><p>如果大家有更好的架构设计理念，欢迎到 go-kratos 社区进行探讨，希望这篇文章对您有帮助~</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考文献">参考文献<a class="hash-link" href="#参考文献" title="Direct link to heading">​</a></h2><ul><li><a href="https://www.ardanlabs.com/blog/2017/02/package-oriented-design.html" target="_blank" rel="noopener noreferrer">Package Oriented Design</a></li><li><a href="https://docs.microsoft.com/en-us/previous-versions/msp-n-p/ee658109(v=pandp.10)" target="_blank" rel="noopener noreferrer">Layered Application Guidelines</a></li><li><a href="https://github.com/golang-standards/project-layout" target="_blank" rel="noopener noreferrer">Standard Go Project Layout</a></li><li><a href="https://github.com/danceyoung/paper-code/blob/master/package-oriented-design/packageorienteddesign.md" target="_blank" rel="noopener noreferrer">Go 面向包的设计和架构分层</a></li><li><a href="https://u.geekbang.org/subject/go" target="_blank" rel="noopener noreferrer">Go 进阶训练营 - 极客时间</a></li></ul></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/go">go</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/golang">golang</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/工程化">工程化</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/项目布局">项目布局</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/最佳实践">最佳实践</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/go-kratos/go-kratos.dev/edit/main/blog/2021-03-08-go-project-layout.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/go-layout-operation-process"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Kratos 学习笔记 - 通过 layout 简单分析应用是如何跑起来的</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#介绍" class="table-of-contents__link toc-highlight">介绍</a></li><li><a href="#项目布局" class="table-of-contents__link toc-highlight">项目布局</a><ul><li><a href="#kit-基础库" class="table-of-contents__link toc-highlight">Kit 基础库</a></li><li><a href="#application-应用项目" class="table-of-contents__link toc-highlight">Application 应用项目</a></li><li><a href="#应用类型" class="table-of-contents__link toc-highlight">应用类型</a></li></ul></li><li><a href="#应用目录" class="table-of-contents__link toc-highlight">应用目录</a><ul><li><a href="#cmd" class="table-of-contents__link toc-highlight">/cmd</a></li><li><a href="#internal" class="table-of-contents__link toc-highlight">/internal</a></li><li><a href="#pkg" class="table-of-contents__link toc-highlight">/pkg</a></li></ul></li><li><a href="#服务应用目录" class="table-of-contents__link toc-highlight">服务应用目录</a><ul><li><a href="#api" class="table-of-contents__link toc-highlight">/api</a></li><li><a href="#configs" class="table-of-contents__link toc-highlight">/configs</a></li><li><a href="#test" class="table-of-contents__link toc-highlight">/test</a></li></ul></li><li><a href="#服务内部目录" class="table-of-contents__link toc-highlight">服务内部目录</a><ul><li><a href="#data" class="table-of-contents__link toc-highlight">data</a></li><li><a href="#biz" class="table-of-contents__link toc-highlight">biz</a></li><li><a href="#service" class="table-of-contents__link toc-highlight">service</a></li><li><a href="#server" class="table-of-contents__link toc-highlight">server</a></li></ul></li><li><a href="#不建议的目录" class="table-of-contents__link toc-highlight">不建议的目录</a><ul><li><a href="#src" class="table-of-contents__link toc-highlight"><del>src/</del></a></li><li><a href="#model" class="table-of-contents__link toc-highlight"><del>model/</del></a></li><li><a href="#xxs" class="table-of-contents__link toc-highlight"><del>xxs/</del></a></li></ul></li><li><a href="#总结" class="table-of-contents__link toc-highlight">总结</a></li><li><a href="#参考文献" class="table-of-contents__link toc-highlight">参考文献</a></li></ul></div></div></div></div></div><footer class="tailwind"><div class="bg-gray-50 pt-8"><div class="container grid grid-cols-4 gap-x-8"><div class="md:col-span-1 col-span-full"><h2 class="font-bold text-xl">Kratos</h2><p class="text-gray-500 text-xs py-4">Kratos is a web application framework with expressive, elegant syntax. We&#x27;ve already laid the foundation.</p><div class="py-4 inline-flex gap-2"><a class="inline-flex items-center" href="https://go-kratos.dev/blog"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 fill-current text-gray-500" viewBox="0 0 1024 1024"><defs><style></style></defs><path d="M928 254.3c-30.6 13.2-63.9 22.7-98.2 26.4 35.4-21.1 62.3-54.4 75-94-32.7 19.5-69.7 33.8-108.2 41.2C765.4 194.6 721.1 174 672 174c-94.5 0-170.5 76.6-170.5 170.6 0 13.2 1.6 26.4 4.2 39.1-141.5-7.4-267.7-75-351.6-178.5-14.8 25.4-23.2 54.4-23.2 86.1 0 59.2 30.1 111.4 76 142.1-28-1.1-54.4-9-77.1-21.7v2.1c0 82.9 58.6 151.6 136.7 167.4-14.3 3.7-29.6 5.8-44.9 5.8-11.1 0-21.6-1.1-32.2-2.6C211 652 273.9 701.1 348.8 702.7c-58.6 45.9-132 72.9-211.7 72.9-14.3 0-27.5-.5-41.2-2.1C171.5 822 261.2 850 357.8 850 671.4 850 843 590.2 843 364.7c0-7.4 0-14.8-.5-22.2 33.2-24.3 62.3-54.4 85.5-88.2z"></path></svg></a><a class="inline-flex items-center" href="https://discord.gg/BWzJsUJ"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 fill-current text-gray-500" viewBox="0 0 1024 1024"><defs><style></style></defs><path d="M862.805 0c59.99 0 108.374 48.512 111.232 105.6V1024L859.82 927.019l-62.72-57.088-68.438-59.648 28.587 94.08H158.293c-59.818 0-108.373-45.44-108.373-105.643V105.813C49.92 48.725 98.56.128 158.507.128h704l.298-.128zM601.771 242.475h-1.28l-8.619 8.533c88.448 25.6 131.243 65.579 131.243 65.579-57.003-28.502-108.374-42.752-159.744-48.512-37.12-5.76-74.24-2.731-105.6 0h-8.534c-20.053 0-62.72 8.533-119.893 31.36-19.925 8.661-31.36 14.336-31.36 14.336s42.752-42.752 136.96-65.579l-5.76-5.76s-71.339-2.73-148.352 54.187c0 0-77.013 134.144-77.013 299.52 0 0 42.666 74.24 159.701 77.056 0 0 17.067-22.742 34.347-42.752-65.707-19.968-91.307-59.904-91.307-59.904s5.717 2.816 14.293 8.533h2.56c1.28 0 1.878.64 2.56 1.28v.256c.683.683 1.28 1.28 2.56 1.28 14.08 5.803 28.16 11.52 39.68 17.067a349.013 349.013 0 0076.8 22.869c39.68 5.76 85.163 8.533 136.96 0 25.6-5.76 51.2-11.392 76.8-22.827 16.64-8.533 37.12-17.066 59.606-31.445 0 0-25.6 39.936-94.08 59.904 14.08 19.883 33.92 42.667 33.92 42.667 117.077-2.56 162.56-76.8 165.12-73.643 0-165.12-77.44-299.52-77.44-299.52-69.76-51.797-135.04-53.76-146.56-53.76l2.389-.853zm7.168 188.288c29.994 0 54.186 25.6 54.186 56.96 0 31.573-24.32 57.173-54.186 57.173-29.867 0-54.187-25.6-54.187-56.917.085-31.574 24.448-57.088 54.187-57.088zm-193.835 0c29.867 0 54.016 25.6 54.016 56.96 0 31.573-24.32 57.173-54.187 57.173-29.866 0-54.186-25.6-54.186-56.917 0-31.574 24.32-57.088 54.186-57.088z"></path></svg></a><a class="inline-flex items-center" href="https://github.com/go-kratos"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 fill-current text-gray-500" viewBox="0 0 1024 1024"><defs><style></style></defs><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9 23.5 23.2 38.1 55.4 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></a><a class="inline-flex items-center" href="https://github.com/go-kratos/kratos/discussions"><svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mr-2 fill-current text-gray-500" viewBox="0 0 1024 1024"><defs><style></style></defs><path d="M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-92.4 233.5h-63.9c-50.1 0-59.8 23.8-59.8 58.8v77.1h119.6l-15.6 120.7h-104V912H539.2V602.2H434.9V481.4h104.3v-89c0-103.3 63.1-159.6 155.3-159.6 44.2 0 82.1 3.3 93.2 4.8v107.9z"></path></svg></a></div></div><div class="md:col-span-3 col-span-full"><div><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a href="/docs/">Guides</a></li><li class="footer__item"><a href="http://v1.go-kratos.dev/" target="_blank" rel="noopener noreferrer"><span class="flex flex-row items-center"><span>Kratos v1(legacy)</span></span></a></li><li class="footer__item"><a href="https://github.com/go-kratos/go-kratos.dev" target="_blank" rel="noopener noreferrer"><span class="flex flex-row items-center"><span>Docs Repo</span></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/BWzJsUJ" target="_blank" rel="noopener noreferrer"><span class="flex flex-row items-center"><span>Discord</span></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/go-kratos/kratos" target="_blank" rel="noopener noreferrer"><span class="flex flex-row items-center"><span>GitHub</span></span></a></li></ul></div></div></div></div><div class="col-span-4"><div><div class="text-sm pb-2">Copyright © 2021 go-kratos.dev</div></div></div></div></div></footer></div>
<script src="/assets/js/runtime~main.752e043b.js"></script>
<script src="/assets/js/main.41ba99e7.js"></script>
</body>
</html>